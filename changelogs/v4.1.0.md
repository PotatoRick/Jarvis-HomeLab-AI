## [4.1.0] - 2025-12-28

### Claude Code CLI Mode

**"Use your Claude Code subscription for zero per-alert remediation costs"**

This release adds CLI mode, allowing Jarvis to use a Claude Code subscription instead of pay-per-token API calls. The Docker container SSHs to Skynet (host) to run Claude CLI with MCP diagnostic tools.

### Added

- **Claude Code CLI integration** (`app/claude_cli.py`): New execution backend that SSHs to Skynet and runs Claude CLI
- **MCP diagnostic tools access**: CLI mode can use `get_container_diagnostics`, `gather_logs`, `check_service_status`, and other MCP tools
- **SFTP prompt transfer**: Writes prompts to temp files via SFTP to avoid shell escaping issues
- **Stdin piping**: Pipes prompts to Claude CLI via stdin for bulletproof delivery
- **Configuration options**: New env vars `USE_CLAUDE_CLI`, `CLAUDE_CLI_PATH`, `SSH_SKYNET_HOST`, `SSH_SKYNET_USER`

### Changed

- **Increased default timeout**: `CLAUDE_TIMEOUT` now defaults to 180s (was 60s) to accommodate CLI startup time
- **Updated documentation**: README, ARCHITECTURE, CONFIGURATION, and COST-OPTIMIZATION docs updated for CLI mode
- **Cost optimization**: CLI mode offers $0/alert vs ~$0.01/alert with API mode

### Technical Details

**Architecture:**
```
Docker (Jarvis Core) --SSH--> Skynet (host) --subprocess--> Claude CLI --MCP--> Infrastructure
```

**Configuration:**
```bash
USE_CLAUDE_CLI=true
CLAUDE_CLI_PATH=/home/t1/.claude/local/claude
SSH_SKYNET_HOST=host.docker.internal
SSH_SKYNET_USER=t1
```

**Trade-offs:**
| Aspect | API Mode | CLI Mode |
|--------|----------|----------|
| Cost | $0.01/alert | $0/alert (subscription) |
| Speed | ~10-30s | ~60-90s |
| MCP Tools | Not available | Full access |

---
